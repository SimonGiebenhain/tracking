function [patterns] = read_patterns(directory_name)
%READ_PATTERNS Summary of this function goes here
%   Detailed explanation goes here
%   ATTENTION: This method currently assumes that all patterns have 4
%   points!

num_points_per_pattern = 4;

folder = dir(directory_name);
for i = 1:size(folder,1)
    filename = folder(i).name;
    if contains(filename, '.vsk')
        patterns(i).pattern = read_pattern(filename);
        patterns(i).name = filename;
    else
        continue;
    end
end
    function pattern = read_pattern(filename)
        pattern = zeros(num_points_per_pattern,3);
        fid = fopen(filename);
        if fid == -1
            parts = strsplit(filename, '.');
            filename = [parts{1,1} 'b.' parts{1,2}]
            fid = fopen(filename);
            if fid == -1
                error('cannot open file')
            end
        end
        tline = fgetl(fid);
        idx = 1;
        while ischar(tline)
            disp(tline)
            parts = strsplit(tline, '"');
            dim = 0;
            if contains(tline, '_x')
                dim = 1;
            elseif contains(tline, '_y')
                dim = 2;
            elseif contains(tline, '_z')
                dim = 3;
            else
                tline = fgetl(fid);
                continue;
            end
            pattern(idx,dim) = str2double(parts{1,num_points_per_pattern});
            if dim == 3
                idx = idx + 1;
                if idx == num_points_per_pattern + 1
                    break;
                end
            end
            tline = fgetl(fid);
        end
        fclose(fid);
    end
end


